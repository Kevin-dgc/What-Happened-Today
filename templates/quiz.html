<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess What Happened Today</title>
    <link rel="stylesheet" href="/static/style.css"> 
</head>
<body>
    <div class="container">
        <h1>Guess What Happened Today</h1>

        <div class="date-selector">
            <select id="monthSelect">
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>

            <select id="daySelect">
                {% for day in range(1, 32) %}
                <option value="{{ day }}">{{ day }}</option>
                {% endfor %}
            </select>

            <button class="change-btn" onclick="changeDate()">Change Date</button>
        </div>

        <div class="facts-container">
            {% for i in range(options|length) %}
            <div class="fact-box" data-index="{{ i }}" data-fact="{{ options[i] }}" data-date="{{ options_dates[i] }}" onclick="selectBox(this)">
                <div class="fact-text">{{ options[i] }}</div>
                <div class="fact-date">Date: {{ options_dates[i] }}</div>
            </div>
            {% endfor %}
        </div>

        <div class="submit-container">
            <button class="submit-btn" id="submitBtn" disabled onclick="handleSubmit()">Submit</button>
        </div>
    </div>

    <script>
        let selectedBox = null;
        let isSubmitted = false;
        const correctAnswerIndex = {{ correct_answer_index }};
        const currentMonth = {{ current_month }};
        const currentDay = {{ current_day }};

        // Set current date from server on load
        window.onload = function() {
            document.getElementById('monthSelect').value = currentMonth;
            document.getElementById('daySelect').value = currentDay;
        };

        function selectBox(box) {
            if (isSubmitted) return; 
            if (selectedBox === box) {
                box.classList.remove('selected');
                selectedBox = null;
                document.getElementById('submitBtn').disabled = true;
            } else {
                if (selectedBox) {
                    selectedBox.classList.remove('selected');
                }
                box.classList.add('selected');
                selectedBox = box;
                document.getElementById('submitBtn').disabled = false;
            }
        }

        function handleSubmit() {
            const submitBtn = document.getElementById('submitBtn');
            
            if (!isSubmitted) {
                isSubmitted = true;
                const selectedIndex = parseInt(selectedBox.dataset.index);
                const isCorrect = selectedIndex === correctAnswerIndex;

                const allBoxes = document.querySelectorAll('.fact-box');
                allBoxes.forEach(box => {
                    box.classList.add('revealed');
                    box.style.cursor = 'default';
                });

                if (isCorrect) {
                    selectedBox.classList.add('correct');
                } else {
                    selectedBox.classList.add('incorrect');
                    
                    // Highlight the correct answer in yellow
                    allBoxes.forEach(box => {
                        if (parseInt(box.dataset.index) === correctAnswerIndex) {
                            box.classList.add('reveal-correct');
                        }
                    });
                }
                submitBtn.textContent = 'Next';
            } else {
                window.location.href = '/';
            }
        }

        function changeDate() {
            const month = document.getElementById('monthSelect').value;
            const day = document.getElementById('daySelect').value;

            const formData = new FormData();
            formData.append('months', month);
            formData.append('days', day);

            fetch('/change_date', {
                method: 'POST',
                body: formData
            })
            .then(() => {
                window.location.href = '/';
            });
        }
    </script>
</body>
</html>